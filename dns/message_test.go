package dns

import (
	"github.com/google/go-cmp/cmp"
	"testing"
)

func TestParseQuery(t *testing.T) {
	// A google.com
	packet := []byte{
		0x51, 0x5c, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x06, 0x67, 0x6f, 0x6f,
		0x67, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00,
		0x00, 0x01, 0x00, 0x01}

	message := Parse(packet)

	expectedHeader := MessageHeader{
		Id:               0x515c,
		RecursionDesired: true,
		QuestionCount:    1}

	if diff := cmp.Diff(message.Header, expectedHeader); diff != "" {
		t.Errorf("headers don't match: %s", diff)
	}
}

func TestParseResponse(t *testing.T) {
	// A google.com
	packet := []byte{
		0x51, 0x5c, 0x81, 0x00, 0x00, 0x01, 0x00, 0x01,
		0x00, 0x00, 0x00, 0x00, 0x06, 0x67, 0x6f, 0x6f,
		0x67, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00,
		0x00, 0x01, 0x00, 0x01, 0x06, 0x67, 0x6f, 0x6f,
		0x67, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00,
		0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x04, 0xac, 0xd9, 0xa9, 0x2e}

	message := Parse(packet)

	expectedHeader := MessageHeader{
		Id:               0x515c,
		Response:         true,
		RecursionDesired: true,
		QuestionCount:    1,
		AnswerCount:      1}

	if diff := cmp.Diff(message.Header, expectedHeader); diff != "" {
		t.Errorf("headers don't match: %s", diff)
	}
}
